# ESP-IDF Installation Manager(EIM) - GUI automated tests

## Concepts

The test infrastructure for the EIM GUI interface should focus on the customer experience with the GUI to provide a consistent experience for users across multiple operating systems and multiple software versions.

Tests should make use of the Tauri-Driver, an interface specially designed to interact with the GUI application through the Webdriver protocol.

## Environment Setup

Tests are developed in Node.js and Selenium-Webdriver, it is required to have Node.js installed on the machine where the tests are executed.

In order to install the Tauri specific files make sure to have Rust and Cargo installed in the system.

On Linux:
`curl https://sh.rustup.rs -sSf | sh`

On Windows:
Download the rust up package [here](https://doc.rust-lang.org/cargo/getting-started/installation.html).

The tests rely on WEbDriver interface from the running operating system on a cross platform wrapper from Tauri, both the webdriver kit and the tauri driver must be installed in the system in order to run the test scripts.

Linux:
Install WebKitWebDriver ( use command `which WebKitWebDriver` to check if available)
`sudo apt install webkit2gtk-driver`

Windows:
Download [Microsoft Edge Driver](https://developer.microsoft.com/en-us/microsoft-edge/tools/webdriver) at the same version from Microsoft Edge installed in the system (Please double check version)
The Edge Driver must be copied on system path, either add the file location to path, or copy it to a valid windows PATH folder (c:\windows)
If changing path note that this is not a permanent change and need to be redone for every new shell, or added to the $profile
`$env:Path += ';C:\<your_folder>'`
`$env:Path += ';'+$env:USERPROFILE+'\EdgeDriver'`

Install the tauri-driver using Cargo:  
`cargo install tauri-driver`

## Running the tests

Test scripts are created to allow launching and running the tests. These scripts do not build the Tauri application, it is necessary to have them compiled before running the tests.

Navigate to the idf-im-cli folder, where the repository was cloned.

The test run is defined in a single script, which will use the test suite specified in the json file passed as command argument for the npm script

The tests relies on environmental variables for the information below, the test scripts also have default values associated to this variables in case environmental variables are not found (ths is useful if running the tests locally)

EIM_GUI_PATH -> Specify the path to the EIM application -> default value Windows: `$USERPROFILE\eim-gui\` Linux/MacOS: `$HOME/eim-gui/`  
EIM_GUI_VERSION -> Version of the EIM application being tested -> default value "0.1.2"  
IDF_VERSION -> The latest released version of ESP-IDF, used on express installation by EIM -> default "v5.4"

Option variables

LOG_TO_FILE="true" -> Enable logs saved to text file on the execution folder -> default false  
DEBUG="true" -> Enable debug level messages generated by the test scripts -> default false

To modify the test parameters, modify the json files located at `/src/tests/runs/suites`
then execute the tests by running the test npm script passing the test script file name as argument:

`npm run test --file=basic_test`

> For Windows use `test-win`

`npm run test-win --file=basic_test`

## References
